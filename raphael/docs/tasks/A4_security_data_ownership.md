# A4 -- 安全模型与数据所有权调研

## 为什么做这件事

通爻网络处理的是个人 Profile 数据（技能、经历、偏好、价值观）和 Agent 协商行为数据。这些数据在多个节点之间流动：用户的 ProfileDataSource（如 SecondMe）、通爻平台（HDC 编码与共振检测）、协商空间（Offer 内容与方案）、以及 WOWOK 区块链（执行记录与回声信号）。

当前架构设计（ARCHITECTURE_DESIGN.md）已考虑了 Adapter 可插拔、投影即函数、本质与实现分离等工程原则，但**尚未系统性地审视安全与隐私边界**。V1 阶段虽然没有大量真实用户数据，但安全知识和隐私保护方向的调研是不受架构变化影响的永久资产。做这件事的价值在于：在系统尚未定型时就把安全约束想清楚，远比事后修补便宜。

你不需要是通爻的核心开发者。你需要的是安全/隐私领域的专业知识，以及将通用安全框架映射到一个具体系统的能力。

## 你要回答什么问题

本任务包含 5 个子问题，每个子问题可独立回答，也可以组合成完整报告。

### A4.1: 通爻的数据流与隐私边界

通爻系统中有哪些数据、在哪些节点可见、以什么形式存在？

需要分析的数据流：
- **Profile 数据流**：用户原始数据（SecondMe 中的文本）-> ProfileDataSource 接口读取 -> 投影为 HDC 超向量 -> 存入通爻数据库 -> 用于共振检测
- **协商数据流**：需求 formulation -> HDC 签名广播 -> Offer 生成（Agent 读取完整需求文本 + 自身 Profile）-> Center 聚合 -> 方案输出
- **回声数据流**：WOWOK 链上事件 -> 通爻记录 -> 回流到 ProfileDataSource -> 数据源更新 Profile
- **身份数据流**：V1 平台签发 agent_id + auth_token；未来可能切换为 DID

关键问题：
- 每个节点分别能看到什么？（平台运营者、协商参与者、其他 Agent、链上观察者）
- 哪些数据是明文流动的？哪些是编码后的？
- 数据的生命周期：什么时候产生？保存多久？谁能删除？

交付：**数据流图 + 隐私边界矩阵**（谁能看到什么，以什么形式）。

### A4.2: 隐私保护技术在向量空间中的应用

通爻的核心操作是"文本 -> 嵌入向量 -> HDC 超向量 -> 共振检测"。在这个流程中，有哪些隐私保护技术可以应用？

需要调研的方向：
- **差分隐私**：在嵌入向量或超向量上加噪声，对共振检测准确率的影响有多大？有没有"隐私预算 vs 准确率"的量化分析？
- **联邦学习**：通爻的 Adapter 模式天然是多数据源架构——能否做到"数据不出数据源，只输出投影"？这和当前的 ProfileDataSource 设计是否兼容？
- **安全多方计算 (MPC)**：协商过程中，能否做到"Center 不看到完整 Offer，只看到聚合结果"？成本多高？
- **同态加密**：能否在加密的超向量上计算汉明距离？性能代价多大？
- **可信执行环境 (TEE)**：共振检测能否放在 TEE 中执行，使平台运营者也无法看到检测过程？

不需要实现任何方案。需要的是：每种技术在通爻场景下**是否可行、成本多高、保护了什么**的判断。

交付：**技术可行性对比表**（技术 / 保护范围 / 性能代价 / 成熟度 / 推荐程度）。

### A4.3: HDC 超向量的隐私属性

HDC 超向量（10,000 维二进制）是通爻网络中公开流通的核心数据。它有一个值得研究的隐私特性：从超向量能否反推出原始文本？

需要回答的具体问题：
- **信息论角度**：SimHash 将 768 维浮点向量投影到 10,000 维二进制向量，这个过程的信息损失有多大？能否从超向量重建原始嵌入向量？
- **攻击角度**：如果攻击者知道 SimHash 的随机超平面矩阵（全网共享），能否利用超向量推断原始文本的语义？能推断到多细的粒度（"这个人是程序员" vs "这个人会 Rust 和分布式系统"）？
- **bundle 操作的影响**：Agent 画像是多个子向量的 bundle。bundle 后信息进一步混合，是增加了还是减少了可逆性？
- **对比**：与传统的嵌入向量（如 768 维浮点数）相比，HDC 超向量的隐私保护是更好还是更差？

这个子任务特别适合有信息安全或信息论背景的人。

交付：**分析报告**，包含理论分析 + 简单实验（如尝试从超向量反推语义类别）。

### A4.4: 去中心化身份 (DID) 与通爻"一自多我"的映射

通爻架构中有一个独特的身份模型："一自多我"——一个人（"自"）可以有多个投影（"我"），包括 Edge Agent（通才投影）和多个 Service Agent / 面具（专才投影）。V1 使用平台签发的 UUID，数据结构已预留向 DID 迁移的字段（见架构文档 Section 6.5.1-6.5.2）。

需要回答的问题：
- **DID 标准调研**：W3C DID、Verifiable Credentials、ION、Ceramic 等方案的现状和成熟度？
- **一自多我的 DID 映射**：一个自然人持有多个 DID（每个"我"一个），还是一个 DID 下挂多个 Verifiable Credential？两种模式的隐私和关联性差异？
- **Sui 链上身份**：WOWOK 在 Sui 链上有 `Personal` 对象——Sui 的账户模型和 DID 如何对接？
- **可关联性风险**：如果同一个人的 Edge Agent 和 Service Agent 使用不同身份，外部观察者能否通过行为模式（协商时间、领域偏好）推断它们属于同一人？

交付：**DID 方案对比 + "一自多我"身份架构建议**。

### A4.5: 安全威胁模型 + 隐私保护方向建议

综合以上子任务的发现，构建通爻网络的安全威胁模型（Threat Model），并给出隐私保护的分阶段建议。

需要覆盖的威胁类型：
- **数据泄露**：平台数据库被入侵 -> 暴露 Profile 数据和 HDC 向量
- **恶意 Agent**：伪造 Profile 数据、提交虚假 Offer、操纵协商结果
- **协商窃听**：非参与者获取协商内容
- **身份关联**：通过链上数据关联不同"我"到同一个"自"
- **模型反演**：通过 Agent 的共振行为推断其 Profile 内容
- **数据源滥用**：Adapter 获取过多 Profile 数据
- **V1 特有风险**：平台模式下，平台运营者是事实上的"超级管理员"

交付：**威胁模型文档**（STRIDE 或类似框架）+ **分阶段保护建议**（V1 必须做的 / V2 应该做的 / 长期方向）。

## 我们提供什么

### 通爻文档（你需要读的部分）

| 文档 | 重点 Section | 与本任务的关系 |
|------|-------------|---------------|
| `docs/ARCHITECTURE_DESIGN.md` Section 0 | 设计原则（本质与实现分离、投影是基本操作、完备性 != 完全性） | 理解安全设计的约束 |
| `docs/ARCHITECTURE_DESIGN.md` Section 1.3 | "一自多我"工程映射 | 身份模型的安全含义 |
| `docs/ARCHITECTURE_DESIGN.md` Section 6.3 | 签名共振机制（HDC 编码、三层过滤、SimHash） | 数据在编码过程中的隐私变化 |
| `docs/ARCHITECTURE_DESIGN.md` Section 6.5 | Agent 接入机制（Adapter 架构、ProfileDataSource） | 数据流的起点和节点 |
| `docs/ARCHITECTURE_DESIGN.md` Section 7 | 基础设施层（Agent 不可用处理、广播机制） | 网络层安全 |
| `docs/ARCHITECTURE_DESIGN.md` Section 11 | 执行与回声阶段（WOWOK 集成、链上数据、回声信号） | 链上数据的隐私暴露 |
| `docs/DESIGN_LOG_001_*.md` | 投影与自我 | "自-我"模型的哲学背景 |
| `docs/DESIGN_LOG_003_*.md` | 投影即函数 | ProfileDataSource 架构 |

### 通爻概念翻译（用安全领域语言）

| 通爻概念 | 安全领域等价概念 |
|---------|----------------|
| 投影（Profile -> HDC 超向量） | 特征提取 / 单向哈希（有损）/ 降维 |
| 共振检测 | 近似最近邻搜索 / 相似度匹配 |
| Adapter / ProfileDataSource | 身份提供者 (IdP) / 数据源接口 |
| 一自多我（Edge + Service Agents） | 多身份管理 / 假名系统 |
| 协商空间 | 安全通信通道 / 多方计算场景 |
| 回声信号 | 审计日志 / 链上可验证凭证 |
| 场景准入 | 访问控制 / 权限管理 |
| WOWOK 链上操作 | 不可篡改审计轨迹 / 公开账本 |

### 已有架构决策（你不需要重新推导的）

- V1 采用平台模式，数据结构兼容未来 DID 迁移
- Agent 身份：V1 = UUID + auth_token，未来 = DID
- HDC 编码：文本 -> sentence-transformers (768d) -> SimHash (10,000d 二进制)
- SimHash 投影矩阵全网共享
- ProfileDataSource 是可插拔接口，数据源自己管理 Profile 更新
- 协作数据回流路径：WOWOK 链上事件 -> 通爻记录 -> 数据源更新
- WOWOK 在 Sui 链上，所有链上操作公开可查

## 子任务分解

| 子任务 | 预计工作量 | 可独立交付 | 前置依赖 |
|-------|-----------|-----------|---------|
| A4.1 数据流与隐私边界 | 3-5 天 | 是 | 无（读架构文档即可） |
| A4.2 隐私保护技术调研 | 5-7 天 | 是 | A4.1 有帮助但非必须 |
| A4.3 HDC 超向量隐私属性 | 3-5 天 | 是 | 无（纯技术分析） |
| A4.4 DID 与一自多我映射 | 3-5 天 | 是 | 无（DID 调研 + 通爻身份模型理解） |
| A4.5 威胁模型 + 建议 | 3-5 天 | 需要 A4.1 完成 | A4.1（数据流图）；A4.2-A4.4 有帮助 |

建议路径：A4.1 先做 -> A4.3（最独立）和 A4.4（最独立）并行 -> A4.2（基于数据流理解）-> A4.5（综合）。

也可以挑一个最感兴趣的子任务单独做。每个子任务独立交付都有价值。

## 做完了是什么样

### 产出格式

- **主报告**：Markdown 文档，8000-15000 字
- **数据流图**：至少 1 张数据流/隐私边界图（可用 Mermaid、draw.io 或手绘扫描）
- **对比表**：至少 2 张决策支持表（技术对比、威胁矩阵）
- **实验代码**（A4.3 如果做实验）：Jupyter Notebook 或 Python 脚本

### 质量标准

**"做完了"**：
- 每个子任务的核心问题有明确的回答（即使回答是"目前无法确定，原因是 X"）
- 数据流图覆盖了上述 4 条主要数据流
- 威胁模型至少覆盖 7 种威胁类型

**"做得好"**：
- 发现了我们没想到的安全风险
- 给出了分阶段可执行的建议（V1 立即可用，不是只有"未来方向"）
- 技术对比有定量分析（性能数据、论文引用）
- 对 HDC 超向量的隐私属性有原创性分析

## 你必须遵守的

1. **不做架构决策**：你的产出是调研和建议，不是"应该这样改"。最终的安全架构决策由核心团队做。
2. **区分 V1 和未来**：V1 是平台模式（信任平台运营者），未来是协议模式（去信任化）。不要用协议模式的标准审判 V1，但要标注"V1 的安全债务"。
3. **有引用**：每个技术方案需要引用来源（论文、RFC、工程实践报告）。不接受"我觉得可以用 X"。
4. **考虑通爻的特殊性**：通爻不是典型的 Web 应用——它是 Agent 协作网络。安全模型需要考虑 Agent 自主行为的维度（不只是"用户认证"）。
5. **不涉及支付安全**：支付问题已被标识为独立子课题（架构文档 Section 11.4.4），本任务不覆盖。

## 你可以自己决定的

- **调研深度的分配**：5 个子任务不需要均匀用力。如果你觉得 A4.3（HDC 隐私属性）是最有价值的发现，可以花 60% 的时间在上面。
- **安全框架选择**：STRIDE、LINDDUN、或你更熟悉的框架都可以。
- **额外发现**：如果你发现了与安全相关但不在上述问题中的重要议题（比如：LLM 提示注入对协商结果的影响），欢迎补充。
- **实验设计**：A4.3 的实验方案完全由你设计。可以不做实验（纯理论分析也有价值）。
- **增减子任务**：如果你认为某个子任务不值得做，说明理由后可以跳过；如果发现更值得做的方向，可以替换。

## 对接方式

- **产出提交到**：`raphael/research/A4_security_data_ownership/`
- **建议节奏**：
  - 第 1 周：A4.1 数据流图（这是后续所有分析的基础）
  - 第 2-3 周：A4.2/A4.3/A4.4（并行或挑重点）
  - 第 4 周：A4.5 综合报告
  - 总周期：3-4 周（按个人时间弹性调整）
- **中间检查点**：A4.1 完成后建议同步一次，确认数据流理解无误
- **有问题找谁**：创始人（架构问题）或 Arch Skill（设计原则解释）
- **后续依赖**：本任务的产出将输入到以下后续工作：
  - V1 安全实现（如果发现必须立即处理的风险）
  - DID 迁移设计（V2+）
  - 隐私保护层设计（长期）

---

*本 PRD 由 Task Arch Skill 设计，定义在问题层而非方案层。*
*关联文档：ARCHITECTURE_DESIGN.md (Section 0/1.3/6.3/6.5/7/11), CONTRIBUTION_TASK_CATALOG.md (A4)*
