# A6 -- Sui 链数据成本与性能实测

## 为什么做这件事

通爻网络的"回声循环"依赖 WOWOK 区块链：协商产生的方案通过 WOWOK 在 Sui 链上执行，执行过程中的链上事件作为"回声信号"回流到通爻，更新 Agent Profile，形成闭环。架构设计（ARCHITECTURE_DESIGN.md Section 11）已明确：V1 直接使用 WOWOK，不做模拟层。

但"直接用链"的前提是**链上操作的成本和性能在可接受范围内**。目前我们缺少这方面的实际数据：

- Sui 上存储一个 Machine 对象需要多少 gas？
- 一次 Progress Forward 操作的延迟是多少？
- 如果 1000 个 Agent 每天进行 100 次协商，月成本是多少美元？

这些数字直接影响后续的架构决策：哪些操作必须上链？哪些可以链下处理？ExecutionAdapter 的抽象边界该画在哪里？

你不需要理解通爻的完整架构。你需要的是 Sui / Move 开发经验，以及做链上 benchmark 的能力。

## 你要回答什么问题

本任务包含 5 个子问题，每个子问题可独立回答。

### A6.1: 通爻可能用到的链上操作清单

基于 WOWOK 的 9 个核心对象（见下方"我们提供什么"），梳理通爻场景下可能涉及的链上操作。

需要覆盖的维度：
- **创建操作**：Machine 创建、Service 创建、Personal 创建
- **状态变更**：Machine.publish()、Progress Forward、Order 状态变更
- **查询操作**：读取 Machine/Service/Progress 状态
- **事件监听**：OnNewOrder、OnNewProgress、OnPresentService、OnNewArb
- **支付相关**：Treasury 操作、结算（V1 使用模拟货币/信用额度）
- **存储操作**：Repository 交付物存储

每个操作需要标注：
- 操作类型（创建 / 修改 / 查询 / 事件）
- 是否涉及链上存储（影响存储成本）
- 预估频率（低频 = 每次协商一次；高频 = 每次 Forward 都触发）
- 是否可以合并或批量处理

交付：**操作清单表**（操作名 / 类型 / 频率 / 存储影响 / 可优化性）。

### A6.2: 测试合约编写

编写 Move 测试合约（或使用 WOWOK 已有合约），模拟通爻典型链上操作。

需要覆盖的典型操作序列（一次完整协商的链上生命周期）：
1. 创建 Machine（JSON 定义的 workflow 模板）
2. 发布 Machine（bPublished = true，不可修改）
3. 创建 Service（绑定 Machine + 价格 + Guards）
4. 创建 Order（购买 Service）
5. 创建 Progress（执行 workflow 实例）
6. Progress Forward（推进 workflow 节点，携带 deliverable 数据）
7. Forward 多次（模拟 3-5 个 workflow 节点）
8. 结算（Treasury 转账）

不需要覆盖所有 WOWOK 对象。专注于上述"协商 -> 执行"的主流程。

交付：**可运行的测试代码**（Move 合约 + 部署脚本 + 调用脚本）。

### A6.3: Sui testnet 实测

在 Sui testnet（或 devnet）上部署 A6.2 的测试合约，实测以下指标。

**成本指标**：
- 每种操作的 gas 消耗（单位：SUI / MIST）
- 对象创建的存储费（Sui 的存储定价模型）
- 存储退款机制（删除对象能回收多少）

**性能指标**：
- 单笔交易的确认时间（finality latency）
- 连续提交 100 笔交易的 TPS（实测，非理论值）
- 并发提交（模拟 10 个 Agent 同时 Forward）的延迟分布

**稳定性指标**：
- testnet 的可用性（测试期间有无中断）
- gas 价格波动（不同时段的 gas 差异）

交付：**实测数据表**（至少每种操作 10 次重复取平均），附原始数据。

### A6.4: 成本模型

基于 A6.3 的实测数据，构建成本模型，回答以下问题：

**基本场景**：
- 1000 个 Agent，每天 100 次协商
- 每次协商：1 个 Machine + 1 个 Service + 1 个 Order + 1 个 Progress + 5 次 Forward
- 月成本（SUI）和月成本（USD，按当前汇率）

**规模场景**：
- 10,000 Agent，每天 1,000 次协商 -> 月成本？
- 边际成本：增加 1 个协商的链上增量成本？
- 存储成本曲线：随时间累积的存储费？（对象越多，存储越贵？）

**优化空间**：
- 如果把某些操作移到链下（如 Progress Forward 只记录最终结果而非每步），能省多少？
- 批量提交（多个操作合并为一笔交易）的效果？
- 使用 Sui 的 Sponsored Transaction 的可能性和成本？

交付：**成本计算器**（Excel / Python 脚本，输入参数可调）+ **成本预测报告**。

### A6.5: 实测报告 + 成本优化建议

综合以上子任务，撰写实测报告，给出以下结论：

- **可行性判断**：以当前 Sui 的成本和性能水平，通爻 V1 直接上链是否可行？
- **成本瓶颈**：哪些操作是成本大头？
- **性能瓶颈**：哪些操作可能影响用户体验（延迟 > 2 秒）？
- **优化建议**：链上 / 链下的分界线应该画在哪？
- **与架构的对齐**：架构文档提到 `ExecutionAdapter` 抽象（Section 11.6 反脆弱表格）——实测数据是否支持"WOWOK 链上成本太高时可切换实现"的反脆弱策略？
- **时间窗口**：Sui 的成本趋势（是在降低还是升高？近 6 个月的变化？）

交付：**实测报告**（5000-8000 字）。

## 我们提供什么

### WOWOK 9 个核心对象速查

| 对象 | 链上行为 | 通爻中的角色 |
|------|---------|-------------|
| **Personal** | 创建链上身份 | Agent 在链上的身份锚点 |
| **Demand** | 发布需求（链上记录） | 需求的链上存证（V1 可能不上链） |
| **Service** | 服务门户（绑定 Machine + 价格 + Guard） | 协商方案的链上实体 |
| **Machine** | workflow 模板（JSON 定义，发布后不可变） | Center 输出的方案 -> Machine 定义 |
| **Progress** | workflow 执行实例（Forward 推进） | 协作的链上执行轨迹 |
| **Order** | 交易实例（购买 Service） | 协作的链上交易记录 |
| **Guard** | 验证引擎（定义条件逻辑） | 协作规则的链上约束 |
| **Treasury** | 支付管理 | 协作的链上结算 |
| **Repository** | 交付物存储 | 协作产出的链上存储 |

### WOWOK 技术资源

| 资源 | 位置 | 说明 |
|------|------|------|
| WOWOK 对象文档 | `/Users/nature/个人项目/wowokWeb/docs/docs/object/` | 9 个对象的详细文档 |
| WOWOK MCP servers | npm `wowok_*_mcp_server` | TypeScript 实现，可本地调试 |
| Sui 开发文档 | https://docs.sui.io/ | 官方文档 |
| Move 语言文档 | https://move-language.github.io/move/ | Move 语法和模式 |

### 通爻架构中的关键设计决策

你需要了解的（不需要全部读完，看相关部分即可）：

| 决策 | 出处 | 与本任务的关系 |
|------|------|---------------|
| V1 直接用 WOWOK，不做模拟层 | Section 11.4.5 | 你的实测数据将验证这个决策的可行性 |
| Machine Template 不预设，运行中沉淀 | Section 11.4.1 | Machine 创建频率可能很高（每次协商一个） |
| 上链 != 承诺，发布 = 承诺 | Section 11.4.2 | Machine 创建 + 发布是两步，成本需分别计量 |
| V1 使用信用额度/模拟货币 | Section 11.4.4 | 不涉及真实 SUI token 转账，但链上操作本身消耗 gas |
| ExecutionAdapter 抽象 | Section 11.6 | 如果 Sui 成本过高，可切换到其他实现 |
| 回声信号来源 = 链上事件 | Section 11.3 | 需要监听链上事件，这些事件的产生有成本 |

### 概念翻译（用区块链/Sui 领域语言）

| 通爻概念 | Sui/区块链等价概念 |
|---------|-----------------|
| 协商方案 -> Machine | 智能合约模板 / workflow 定义 |
| 方案执行 -> Progress | 合约执行实例 / 状态机推进 |
| 回声信号 | 链上事件 (Events) / 状态变更日志 |
| 投影即函数 | 链下计算 + 链上验证 |
| ExecutionAdapter | 链抽象层 / 跨链桥 |
| 场景 (Scene) | 命名空间 / 链上 namespace |

## 子任务分解

| 子任务 | 预计工作量 | 可独立交付 | 前置依赖 |
|-------|-----------|-----------|---------|
| A6.1 链上操作清单 | 2-3 天 | 是 | 无（读 WOWOK 文档） |
| A6.2 测试合约编写 | 3-5 天 | 是 | A6.1（知道要测什么） |
| A6.3 Sui testnet 实测 | 3-5 天 | 是 | A6.2（有合约才能测） |
| A6.4 成本模型 | 2-3 天 | 是 | A6.3（需要实测数据） |
| A6.5 实测报告 | 2-3 天 | 需要 A6.3/A6.4 | A6.1-A6.4 综合 |

建议路径：A6.1 -> A6.2 -> A6.3 -> A6.4 -> A6.5（串行，每步依赖上一步）。

如果时间有限，**A6.1 + A6.3（跳过自写合约，直接用 WOWOK MCP）+ A6.4 的最小版本**是最高价值的组合。

## 做完了是什么样

### 产出格式

- **实测报告**：Markdown 文档，5000-8000 字
- **测试代码**：Move 合约 + 部署/调用脚本（可运行）
- **成本计算器**：Excel 或 Python 脚本（参数可调，输入 Agent 数 / 协商次数 -> 输出月成本）
- **原始数据**：测试中收集的所有交易 hash、gas 消耗、延迟数据（CSV 或 JSON）

### 质量标准

**"做完了"**：
- 操作清单覆盖了上述 8 步主流程
- 至少 5 种操作有实测 gas 数据（每种 >= 10 次重复）
- 成本模型能回答"1000 Agent / 100 次协商 / 月"的成本问题
- 给出了明确的可行性判断（可行 / 有风险 / 不可行）

**"做得好"**：
- 测试覆盖了边界情况（大对象存储、高并发、gas 价格波动）
- 成本模型有多场景对比（基本 / 优化 / 极端）
- 发现了成本优化的具体手段（如批量提交的实际效果）
- 给出了"链上 / 链下分界线"的具体建议，并用数据支撑
- 对比了 Sui 与其他 L1/L2 的成本（如有精力）

## 你必须遵守的

1. **实测数据优先于理论数据**：Sui 官方文档中的 TPS 和 gas 数据是理论值。我们要的是 testnet 上的实测值。理论值可以作为参考，但结论必须基于实测。
2. **使用 Sui testnet 或 devnet**：不要在 mainnet 上测试（浪费真金白银）。标注测试环境的版本和时间。
3. **成本用 USD 表示**：最终的成本结论需要转换为 USD（标注汇率和时间）。SUI token 价格波动大，给出汇率区间（当前价 + 近 6 个月最高/最低）的成本区间。
4. **不做架构决策**：你的产出是数据和建议，不是"应该不上链"。最终决策由核心团队做。
5. **代码可复现**：测试代码和脚本需要其他人能跑通。包含 README、环境要求、运行步骤。

## 你可以自己决定的

- **测试工具选择**：Sui CLI、TypeScript SDK、Python SDK、WOWOK MCP server -- 用你最熟悉的。
- **测试规模**：只要每种操作 >= 10 次重复，规模上限由你决定。如果你想跑 1000 次也可以。
- **额外对比**：如果你有其他链的经验（Ethereum L2、Solana、Aptos），可以补充对比数据。不是必须的。
- **WOWOK 合约使用方式**：可以直接用 WOWOK 已有合约（通过 MCP server），也可以自己写简化版 Move 合约模拟。
- **成本优化深度**：A6.4 的优化分析深度由你决定。如果你发现了一个显著的优化路径，可以深入。

## 对接方式

- **产出提交到**：`raphael/research/A6_sui_chain_benchmark/`
- **建议节奏**：
  - 第 1 周：A6.1 操作清单 + A6.2 测试合约
  - 第 2 周：A6.3 实测（可能需要反复调试）
  - 第 3 周：A6.4 成本模型 + A6.5 报告
  - 总周期：2-3 周
- **中间检查点**：A6.1 完成后建议同步一次，确认操作清单的覆盖范围
- **有问题找谁**：
  - WOWOK 相关：创始人（有 WOWOK 对象的详细文档和 MCP 源码）
  - Sui 开发环境：Sui 官方 Discord / 文档
  - 通爻架构：创始人或 Arch Skill
- **后续依赖**：本任务的产出将输入到以下后续工作：
  - ExecutionAdapter 设计（链上/链下分界线的工程决策）
  - V1 成本预算（运营决策）
  - 反脆弱策略验证（WOWOK 链上成本太高时的备选方案）

---

*本 PRD 由 Task Arch Skill 设计，定义在问题层而非方案层。*
*关联文档：ARCHITECTURE_DESIGN.md (Section 11), CONTRIBUTION_TASK_CATALOG.md (A6)*
